<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Szavazás Eredmények – Talentum Nap</title>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDmb4zgzbOlF_8KtjwaCJn3y_2DwYapqQk",
      authDomain: "talentum-nap.firebaseapp.com",
      databaseURL: "https://talentum-nap-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "talentum-nap",
      storageBucket: "talentum-nap.firebasestorage.app",
      messagingSenderId: "930243290620",
      appId: "1:930243290620:web:4ce6c75911ecd13ba4be79"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const resultsDiv = document.getElementById("results");

    // Funkció az eredmények megjelenítésére
    function displayResults(options, currentGroup) {
      if (!options) {
        resultsDiv.textContent = "Nincsenek szavazatok még.";
        return;
      }

      const start = currentGroup * 3;
      const end = start + 3;
      const groupOptions = [];
      let maxVotes = 1; // elkerüljük a 0 osztást

      for (let i = start; i < end; i++) {
        const opt = options[i];
        if (opt) {
          groupOptions.push(opt);
          if (opt.votes > maxVotes) maxVotes = opt.votes;
        }
      }

      let html = "";
        groupOptions.forEach(opt => {
        const widthPercent = maxVotes > 0 ? (opt.votes / maxVotes) * 100 : 0;
        
        // Csak akkor rakjuk bele a progress bart, ha van legalább 1 szavazat
        const progressBarHtml = opt.votes > 0 
            ? `<div class="progress-bar" style="width:${widthPercent}%">${opt.votes}</div>`
            : `` ;  // vagy akár csak simán a számot

        html += `
            <div class="result-item">
            <div class="result-text">${opt.text}</div>
            <div class="progress-bar-container">
                ${progressBarHtml}
            </div>
            </div>
        `;
        });

      resultsDiv.innerHTML = html;
    }

    // Figyelés Firebase-ből
    const optionsRef = ref(db, "options");
    const groupRef = ref(db, "currentGroup");

    onValue(groupRef, groupSnap => {
      const currentGroup = groupSnap.val() || 0;
      onValue(optionsRef, optionsSnap => {
        const options = optionsSnap.val();
        displayResults(options, currentGroup);
      });
    });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1b2a;
      color: white;
      text-align: center;
      padding: 40px;
      margin: 0;
    }

    h1 {
      color: #00cc00;
      margin-bottom: 30px;
    }

    #results {
      background: #1b263b;
      padding: 20px;
      border-radius: 12px;
      min-height: 120px;
      max-width: 600px;
      margin: 0 auto;
    }

    .result-item {
      margin-bottom: 12px;
      text-align: left;
    }

    .result-text {
      font-weight: bold;
      margin-bottom: 6px;
    }

    .progress-bar-container {
      background: #0d1b2a;
      border-radius: 6px;
      overflow: hidden;
      height: 24px;
    }

    .progress-bar {
      height: 100%;
      background: #1b98e0;
      width: 0%;
      text-align: right;
      color: white;
      padding-right: 8px;
      box-sizing: border-box;
      transition: width 0.5s ease;
      line-height: 24px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Szavazás Eredmények – Talentum Nap</h1>

  <div id="results">
    Betöltés...
  </div>

</body>
</html>
